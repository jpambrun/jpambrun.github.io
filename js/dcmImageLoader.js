/*
 jpxTest 2015-02-20 
*/
var cornerstoneDCMJ2KImageLoader=function(a,b,c){function d(c){for(var d,e=a.Deferred(),f=parseImageId(c),h=f.requestedQuality-1;h>=1&&void 0===d;h--)d=b.imageCache.getImagePromise(f.scheme+":"+f.url+"?quality="+h);k[c]=e;var l=j.indexOf(!0);if(void 0!==d)d.then(function(a){var b=new Uint8Array(a.getDcmData()),d={imageId:c,parsedDicomData:a.parsedDicomData,oldDcmData:b};-1===l?i.unshift(d):(d.workerId=l,j[l]=!1,g[l].postMessage(d,[b.buffer]))});else{var m={imageId:c};-1===l?i.push(m):(m.workerId=l,j[l]=!1,g[l].postMessage(m))}return e}function e(a){var c=new Int16Array(a.data.pixelData),d=new Uint8Array(a.data.dcmData),e=a.data.width,f=a.data.height,l=a.data.imageId,m=a.data.loadedLayers,n=a.data.parsedDicomData,o=(parseImageId(l),{imageId:l,minPixelValue:-1100,maxPixelValue:2500,windowCenter:-600,windowWidth:1600,render:b.renderGrayscaleImage,getDcmData:function(){return d},getPixelData:function(){return c},rows:e,columns:f,height:f,width:e,color:!1,columnPixelSpacing:.8984375,rowPixelSpacing:.8984375,slope:n.rescaleSlope,intercept:n.rescaleIntercept,compressedFileSize:a.data.fileSize,downloadTime:a.data.downloadTime,decodingTime:a.data.decodeTime,sizeInBytes:d.length+2*c.length,loadedLayers:m,parsedDicomData:n});void 0!==h&&h();var p=k[l];if(delete k[l],0!==i.length){var q=i.shift();q.workerId=a.data.workerId,q.hasOwnProperty("oldDcmData")?g[a.data.workerId].postMessage(q,[q.oldDcmData.buffer]):g[a.data.workerId].postMessage(q)}else j[a.data.workerId]=!0;p.resolve(o)}function f(a){h=a}void 0===c&&(c={});var g,h,i=[],j=[],k={},l=8;if(void 0===g){g=[];for(var m=0;l>m;m++)g[m]=new Worker("js/dcmdlworker.js"),g[m].onmessage=e,j[m]=!0}return b.registerImageLoader("dcmj2k",d),c.setCallback=f,c}($,cornerstone,cornerstoneDCMJ2KImageLoader);