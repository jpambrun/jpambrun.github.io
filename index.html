<!DOCTYPE HTML><html><head><title>DICOM Viewer</title><meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1,maximum-scale=1"><link href="./js/cornerstone.css" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="./css/paper.min.css" rel="stylesheet" type="text/css"><link href="./css/font.css" rel="stylesheet" type="text/css"><style type="text/css">body {
            padding-top: 20px
        }</style><script src="//code.jquery.com/jquery-2.1.1.js" type="text/javascript"></script><script src="//cdn.jsdelivr.net/jquery.hammerjs/1.1.2/jquery.hammer-full.min.js" type="text/javascript"></script><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js"></script><script src="./js/cornerstone.js" type="text/javascript"></script><script src="./js/cornerstonemath.js" type="text/javascript"></script><script src="./js/cornerstonetools.js" type="text/javascript"></script><script src="./js/utils.js" type="text/javascript"></script><script src="./js/dcmImageLoader.js" type="text/javascript"></script><script src="./js/dicomparser.js" type="text/javascript"></script><script type="text/javascript">function stackOnDrag(e){var t=e.originalEvent.detail,a=t.deltaPoints.page.y;return a>=3?nextImage():-3>=a&&prevImage(),!1}function disableAllTools(e){cornerstoneTools.touchDragTool(stackOnDrag).deactivate(e),cornerstoneTools.panTouchDrag.deactivate(e),cornerstoneTools.wwwcTouchDrag.deactivate(e),cornerstoneTools.pan.activate(e,2),cornerstoneTools.zoom.activate(e,4),cornerstoneTools.probe.deactivate(e,1),cornerstoneTools.length.deactivate(e,1),cornerstoneTools.angle.deactivate(e,1)}function changeImage(e,t,a,o){if(cornerstone.displayImage(t,a),e.find(".topleft").html("Patient Name: "+a.parsedDicomData.patientName+"<br>SomeOtherField: multi-line test"),e.find(".bottomleft").text(a.parsedDicomData.sliceLocation),e.find(".topright").html(a.loadedLayers!==a.parsedDicomData.numberOfLayers?1===a.loadedLayers?'<span style="font-size: 1.2em;color: #CC3300;" class="glyphicon glyphicon glyphicon-eye-close"></span>':'<span style="font-size: 1.2em;color: #FFD119;" class="glyphicon glyphicon glyphicon-eye-close"></span>':'<span style="font-size: 1.2em;" class="glyphicon glyphicon glyphicon-eye-open"></span>'),window.clearTimeout(viewTimerId),a.loadedLayers<a.parsedDicomData.numberOfLayers){var r=parseImageId(o);viewTimerId=window.setTimeout(function(){var a=r.scheme+":"+r.url+"?quality="+(Number(r.requestedQuality)+1);urls[currentImage]=a,cornerstone.loadAndCacheImage(a).then(function(a){currentParsedImageId=parseImageId(urls[currentImage]),currentParsedImageId.url==r.url&&changeImage(e,t,a,a.imageId)})},100,o)}}function progressCallback(e){perfStats.requestStats.push(e),e.isUpdate?(perfStats.totalUpdateSize+=e.fileSize,perfStats.totalUpdateDownloadTime+=e.downloadTime,perfStats.totalUpdateDecodeTime+=e.j2kDecodeTime,perfStats.updateCount+=1,console.log("update decode time : "+e.j2kDecodeTime)):(perfStats.totalInitialSize+=e.fileSize,perfStats.totalInitialDownloadTime+=e.downloadTime,perfStats.totalInitialDecodeTime+=e.j2kDecodeTime,perfStats.totalInitialDicomParsingTime+=e.dicomParseTime,$("#progress-bar").width(++perfStats.progress/(maxImage-1)*100+"%"),perfStats.progress==maxImage-1&&($("#progress-bar-container").css("visibility","hidden"),perfStats.decodeCompleteTime=Date.now()));var t=cornerstone.imageCache.getCacheInfo();$("#innerStats").html("Total initial downlaod time: {0} s (Avr: {1} ms) <br>".format((perfStats.totalInitialDownloadTime/1e3).toFixed(2),(perfStats.totalInitialDownloadTime/perfStats.progress).toFixed(2))+"Total initial dicom paring time: {0} s (Avr: {1} ms) <br>".format((perfStats.totalInitialDicomParsingTime/1e3).toFixed(2),(perfStats.totalInitialDicomParsingTime/perfStats.progress).toFixed(2))+"Total initial decode time: {0} s (Avr: {1} ms) <br>".format((perfStats.totalInitialDecodeTime/1e3).toFixed(2),(perfStats.totalInitialDecodeTime/perfStats.progress).toFixed(2))+"Total initial size: {0} mb (Avr: {1} kb) <br>".format((perfStats.totalInitialSize/1024/1024).toFixed(2),(perfStats.totalInitialSize/1024/perfStats.progress).toFixed(2))+"Total update downlaod time: {0} s (Avr: {1} ms) <br>".format((perfStats.totalUpdateDownloadTime/1e3).toFixed(2),(perfStats.totalUpdateDownloadTime/perfStats.updateCount).toFixed(2))+"Total update decode time: {0} s (Avr: {1} ms) <br>".format((perfStats.totalUpdateDecodeTime/1e3).toFixed(2),(perfStats.totalUpdateDecodeTime/perfStats.updateCount).toFixed(2))+"Total update size: {0} mb (Avr: {1} kb) <br>".format((perfStats.totalUpdateSize/1024/1024).toFixed(2),(perfStats.totalUpdateSize/1024/perfStats.updateCount).toFixed(2))+"Time to first slice: {0} ms <br>".format((perfStats.firstImageTime-pageReadyTime).toFixed(2))+"Time to finish initial downlaod and decode for all slices : {0} ms <br>".format((perfStats.decodeCompleteTime-pageReadyTime).toFixed(2))+"{0} image(s) in cache using {1} mb of a maximum of {2} mb <br>".format(t.numberOfImagesCached,(t.cacheSizeInBytes/1024/1024).toFixed(0),(t.maximumSizeInBytes/1024/1024).toFixed(0)))}function nextImage(){$("#prevbtn").removeClass("disabled");var e=$("#im1"),t=e.get(0);maxImage>currentImage&&(currentImage+=1,cornerstone.loadAndCacheImage(urls[currentImage]).then(function(a){changeImage(e,t,a,urls[currentImage]),currentImage===maxImage&&$("#nextbtn").addClass("disabled")}))}function prevImage(){$("#nextbtn").removeClass("disabled");var e=$("#im1"),t=e.get(0);currentImage>0&&(currentImage-=1,cornerstone.loadAndCacheImage(urls[currentImage]).then(function(a){changeImage(e,t,a,urls[currentImage]),0===currentImage&&$("#prevbtn").addClass("disabled")}))}function clearAllBtn(){$("#lengthbtn").removeClass("btn-primary").addClass("btn-default"),$("#anglebtn").removeClass("btn-primary").addClass("btn-default"),$("#pickerbtn").removeClass("btn-primary").addClass("btn-default"),$("#wlbtn").removeClass("btn-primary").addClass("btn-default"),$("#stackbtn").removeClass("btn-primary").addClass("btn-default"),$("#movebtn").removeClass("btn-primary").addClass("btn-default")}function setupDicomViewer(){cornerstone.imageCache.setMaximumSizeBytes(1048576e3),cornerstoneDCMJ2KImageLoader.setProgressCallback(progressCallback);for(var e=0;maxImage>=e;e++){var t="000000000"+e,a="http://jpambrun.github.io/data/"+t.substr(t.length-6)+".dcm?quality=1";urls.push("dcmj2k:"+a),cornerstone.loadAndCacheImage(urls[e])}var o=$("#im1"),r=o.get(0);cornerstone.enable(r),o.on("mousewheel DOMMouseScroll",function(e){return e.originalEvent.wheelDelta<0||e.originalEvent.detail>0?prevImage():nextImage(),!1}),$("#wlbtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),t=e.get(0);disableAllTools(t),cornerstoneTools.wwwcTouchDrag.activate(t)}),$("#nextbtn").click(function(){nextImage()}),$("#pickerbtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),t=e.get(0);disableAllTools(t),cornerstoneTools.probe.activate(t,1)}),$("#movebtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),t=e.get(0);disableAllTools(t),cornerstoneTools.panTouchDrag.activate(t)}),$("#stackbtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),t=e.get(0);disableAllTools(t),cornerstoneTools.touchDragTool(stackOnDrag).activate(t)}),$("#anglebtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),t=e.get(0);disableAllTools(t),cornerstoneTools.angle.activate(t,1)}),$("#lengthbtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),t=e.get(0);disableAllTools(t),cornerstoneTools.length.activate(t,1)}),$("#prevbtn").click(function(){prevImage()}),$("#stats").on("click",function(){$("#statsModal").modal("show")}),$("#savebtn").on("click",function(){var e=new Blob([JSON.stringify(perfStats,null," ")],{type:"text/plain;charset=utf-8"});saveAs(e,"perfstats.json")}),cornerstone.loadAndCacheImage(urls[0]).then(function(e){perfStats.firstImageTime=Date.now(),changeImage(o,r,e,urls[0]),cornerstoneTools.mouseInput.enable(r),cornerstoneTools.mouseWheelInput.enable(r),cornerstoneTools.pan.activate(r,2),cornerstoneTools.zoom.activate(r,4),cornerstoneTools.probe.enable(r),cornerstoneTools.length.enable(r),cornerstoneTools.ellipticalRoi.enable(r),cornerstoneTools.rectangleRoi.enable(r),cornerstoneTools.angle.enable(r),cornerstoneTools.touchInput.enable(r),cornerstoneTools.zoomTouchPinch.activate(r),cornerstoneTools.wwwcTouchDrag.activate(r)})}var maxImage=499,currentImage=0,urls=[],pageReadyTime=0,viewTimerId,perfStats={requestStats:[],progress:0,updateCount:0,firstImageTime:0,decodeCompleteTime:0/0,totalInitialSize:0,totalInitialDownloadTime:0,totalInitialDecodeTime:0,totalInitialDicomParsingTime:0,totalUpdateSize:0,totalUpdateDownloadTime:0,totalUpdateDecodeTime:0};String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,a){return"undefined"!=typeof e[a]?e[a]:t})}),$(document).ready(function(){pageReadyTime=Date.now(),setupDicomViewer()});</script></head><body><div class="container-fluid" style="max-width:650px"><div class="panel panel-default"><div class="panel-heading"><h4>DICOM-J2K viewer</h4></div><div class="panel-body center-block"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><div id="im1" data-index="0" style="width:512px;height:512px;position:relative" class="cornerstone-enabled-image center-block" oncontextmenu="return!1" unselectable="on" onselectstart="return!1" onmousedown="return!1"><div class="topleft" style="position: absolute;top:7px; left:7px; color: #fff;line-height: 100%"></div><div class="topright" style="position: absolute;top:7px; right:7px; color: #fff;line-height: 100%"></div><div class="bottomright" style="position: absolute;bottom:7px; right:7px; color: #fff;line-height: 100%"></div><div class="bottomleft" style="position: absolute;bottom:7px; left:7px; color: #fff;line-height: 100%"></div></div><div id="progress-bar-container" class="progress progress-striped active center-block" style="width:512px"><div id="progress-bar" class="progress-bar" style="width: 0%"></div></div></div></div><div class="row center-block"><div class="col-xs-2 col-sm-2 col-md-2 col-lg-2 text-right"><button id="prevbtn" type="button" class="btn btn-default disabled"><span class="glyphicon glyphicon-chevron-left"></button></div><div class="col-xs-8 col-sm-8 col-md-8 col-lg-8 text-center"><div class="btn-group"><button id="wlbtn" type="button" class="btn btn-primary"><span class="glyphicon icon-dicom-contrast"></span></button> <button id="pickerbtn" type="button" class="btn btn-default"><span class="glyphicon glyphicon-screenshot"></span></button> <button id="lengthbtn" type="button" class="btn btn-default"><span class="glyphicon icon-dicom-length"></span></button> <button id="anglebtn" type="button" class="btn btn-default"><span class="glyphicon icon-dicom-angle"></span></button> <button id="stackbtn" type="button" class="btn btn-default"><span class="glyphicon icon-dicom-stack"></span></button> <button id="movebtn" type="button" class="btn btn-default"><span class="glyphicon icon-dicom-move"></span></button></div></div><div class="col-xs-2 col-sm-2 col-md-2 col-lg-2 text-left"><button id="nextbtn" type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button></div></div></div><div class="panel-footer text-right">Jean-Francois Pambrun - <a id="stats" href="javascript:void(0)">stats</a></div></div></div><div class="modal fade" id="statsModal" tabindex="-1" role="dialog" aria-labelledby="statsModal" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span> <span class="sr-only">Close</span></button><h4 class="modal-title" id="myModalLabel">Global performance stats</h4></div><div class="modal-body" id="innerStats"></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button> <button type="button" class="btn btn-primary" id="savebtn">Save</button></div></div></div></div></body></html>