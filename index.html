<!DOCTYPE HTML><html><head><title>DICOM Viewer</title><meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1,maximum-scale=1"><link href="./js/cornerstone.css" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="./css/paper.min.css" rel="stylesheet" type="text/css"><link href="./css/font.css" rel="stylesheet" type="text/css"><style type="text/css">body {
            padding-top: 20px
        }</style><script src="//code.jquery.com/jquery-2.1.1.js" type="text/javascript"></script><script src="//cdn.jsdelivr.net/jquery.hammerjs/1.1.2/jquery.hammer-full.min.js" type="text/javascript"></script><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script src="./js/cornerstone.js" type="text/javascript"></script><script src="./js/cornerstonemath.js" type="text/javascript"></script><script src="./js/cornerstonetools.js" type="text/javascript"></script><script src="./js/utils.js" type="text/javascript"></script><script src="./js/dcmImageLoader.js" type="text/javascript"></script><script src="./js/dicomparser.js" type="text/javascript"></script><script type="text/javascript">function stackOnDrag(e){var a=e.originalEvent.detail,t=a.deltaPoints.page.y;return t>=3?nextImage():-3>=t&&prevImage(),!1}function disableAllTools(e){cornerstoneTools.touchDragTool(stackOnDrag).deactivate(e),cornerstoneTools.panTouchDrag.deactivate(e),cornerstoneTools.wwwcTouchDrag.deactivate(e),cornerstoneTools.pan.activate(e,2),cornerstoneTools.zoom.activate(e,4),cornerstoneTools.probe.deactivate(e,1),cornerstoneTools.length.deactivate(e,1),cornerstoneTools.angle.deactivate(e,1)}function changeImage(e,a,t,o){if(cornerstone.displayImage(a,t),e.find(".topleft").html("Patient Name: "+t.parsedDicomData.patientName+"<br>SomeOtherField: multi-line test"),e.find(".bottomleft").text(t.parsedDicomData.sliceLocation),e.find(".topright").html(t.loadedLayers!==t.parsedDicomData.numberOfLayers?1===t.loadedLayers?'<span style="font-size: 1.2em;color: #CC3300;" class="glyphicon glyphicon glyphicon-eye-close"></span>':'<span style="font-size: 1.2em;color: #FFD119;" class="glyphicon glyphicon glyphicon-eye-close"></span>':'<span style="font-size: 1.2em;" class="glyphicon glyphicon glyphicon-eye-open"></span>'),window.clearTimeout(viewTimerId),t.loadedLayers<t.parsedDicomData.numberOfLayers){var n=parseImageId(o);viewTimerId=window.setTimeout(function(){var t=n.scheme+":"+n.url+"?quality="+(Number(n.requestedQuality)+1);urls[currentImage]=t,cornerstone.loadAndCacheImage(t).then(function(t){currentParsedImageId=parseImageId(urls[currentImage]),currentParsedImageId.url==n.url&&changeImage(e,a,t,t.imageId)})},200,o)}}function loaderInc(){$("#progress-bar").width(++progress/(maxImage-1)*100+"%"),progress==maxImage-1&&($("#progress-bar-container").css("visibility","hidden"),decodeCompleteTime=Date.now())}function nextImage(){$("#prevbtn").removeClass("disabled");var e=$("#im1"),a=e.get(0);maxImage>currentImage&&(currentImage+=1,cornerstone.loadAndCacheImage(urls[currentImage]).then(function(t){changeImage(e,a,t,urls[currentImage]),currentImage===maxImage&&$("#nextbtn").addClass("disabled")}))}function prevImage(){$("#nextbtn").removeClass("disabled");var e=$("#im1"),a=e.get(0);currentImage>0&&(currentImage-=1,cornerstone.loadAndCacheImage(urls[currentImage]).then(function(t){changeImage(e,a,t,urls[currentImage]),0===currentImage&&$("#prevbtn").addClass("disabled")}))}function clearAllBtn(){$("#lengthbtn").removeClass("btn-primary").addClass("btn-default"),$("#anglebtn").removeClass("btn-primary").addClass("btn-default"),$("#pickerbtn").removeClass("btn-primary").addClass("btn-default"),$("#wlbtn").removeClass("btn-primary").addClass("btn-default"),$("#stackbtn").removeClass("btn-primary").addClass("btn-default"),$("#movebtn").removeClass("btn-primary").addClass("btn-default")}function setupDicomViewer(){cornerstone.imageCache.setMaximumSizeBytes(1048576e3),cornerstoneDCMJ2KImageLoader.setCallback(loaderInc);for(var e=0;maxImage>=e;e++){var a="000000000"+e,t="http://jpx.jfpb.net/data/"+a.substr(a.length-6)+".dcm?quality=1";urls.push("dcmj2k:"+t),cornerstone.loadAndCacheImage(urls[e])}var o=$("#im1"),n=o.get(0);cornerstone.enable(n),o.on("mousewheel DOMMouseScroll",function(e){return e.originalEvent.wheelDelta<0||e.originalEvent.detail>0?prevImage():nextImage(),!1}),$("#wlbtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),a=e.get(0);disableAllTools(a),cornerstoneTools.wwwcTouchDrag.activate(a)}),$("#nextbtn").click(function(){nextImage()}),$("#pickerbtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),a=e.get(0);disableAllTools(a),cornerstoneTools.probe.activate(a,1)}),$("#movebtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),a=e.get(0);disableAllTools(a),cornerstoneTools.panTouchDrag.activate(a)}),$("#stackbtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),a=e.get(0);disableAllTools(a),cornerstoneTools.touchDragTool(stackOnDrag).activate(a)}),$("#anglebtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),a=e.get(0);disableAllTools(a),cornerstoneTools.angle.activate(a,1)}),$("#lengthbtn").click(function(){clearAllBtn(),$(this).removeClass("btn-default").addClass("btn-primary");var e=$("#im1"),a=e.get(0);disableAllTools(a),cornerstoneTools.length.activate(a,1)}),$("#prevbtn").click(function(){prevImage()}),$("#stats").on("click",function(){if(maxImage===progress-1)for(var e=0,a=0,t=0,o=0;maxImage>=o;o++){cornerstone.loadAndCacheImage(urls[o]).then(function(o){e+=o.compressedFileSize,a+=o.downloadTime,t+=o.decodingTime});var n=cornerstone.imageCache.getCacheInfo();$("#innerStats").html("Total Downlaod time: {0} s (Avr: {1} ms) <br>".format((a/1e3).toFixed(2),(a/progress).toFixed(2))+"Total Decode time: {0} s (Avr: {1} ms) <br>".format((t/1e3).toFixed(2),(t/progress).toFixed(2))+"Total size: {0} mb (Avr: {1} kb) <br>".format((e/1024).toFixed(2),(e/progress).toFixed(2))+"Time to first slice: {0} ms <br>".format((firstImageTime-pageReadyTime).toFixed(2))+"Time to finish: {0} ms <br>".format((decodeCompleteTime-pageReadyTime).toFixed(2))+"{0} image(s) in cache using {1} mb of a maximum of {2} mb <br>".format(n.numberOfImagesCached,(n.cacheSizeInBytes/1024/1024).toFixed(0),(n.maximumSizeInBytes/1024/1024).toFixed(0))),$("#statsModal").modal("show")}}),cornerstone.loadAndCacheImage(urls[0]).then(function(e){firstImageTime=Date.now(),changeImage(o,n,e,urls[0]),cornerstoneTools.mouseInput.enable(n),cornerstoneTools.mouseWheelInput.enable(n),cornerstoneTools.pan.activate(n,2),cornerstoneTools.zoom.activate(n,4),cornerstoneTools.probe.enable(n),cornerstoneTools.length.enable(n),cornerstoneTools.ellipticalRoi.enable(n),cornerstoneTools.rectangleRoi.enable(n),cornerstoneTools.angle.enable(n),cornerstoneTools.touchInput.enable(n),cornerstoneTools.zoomTouchPinch.activate(n),cornerstoneTools.wwwcTouchDrag.activate(n)})}var maxImage=500,progress=0,currentImage=0,urls=[],pageReadyTime=0,firstImageTime=0,decodeCompleteTime=0,viewTimerId;String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(a,t){return"undefined"!=typeof e[t]?e[t]:a})}),$(document).ready(function(){pageReadyTime=Date.now(),setupDicomViewer()});</script></head><body><div class="container-fluid" style="max-width:650px"><div class="panel panel-default"><div class="panel-heading"><h4>DICOM-J2K viewer</h4></div><div class="panel-body center-block"><div class="row"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><div id="im1" data-index="0" style="width:512px;height:512px;position:relative" class="cornerstone-enabled-image center-block" oncontextmenu="return!1" unselectable="on" onselectstart="return!1" onmousedown="return!1"><div class="topleft" style="position: absolute;top:7px; left:7px; color: #fff;line-height: 100%"></div><div class="topright" style="position: absolute;top:7px; right:7px; color: #fff;line-height: 100%"></div><div class="bottomright" style="position: absolute;bottom:7px; right:7px; color: #fff;line-height: 100%"></div><div class="bottomleft" style="position: absolute;bottom:7px; left:7px; color: #fff;line-height: 100%"></div></div><div id="progress-bar-container" class="progress progress-striped active center-block" style="width:512px"><div id="progress-bar" class="progress-bar" style="width: 0%"></div></div></div></div><div class="row center-block"><div class="col-xs-2 col-sm-2 col-md-2 col-lg-2 text-right"><button id="prevbtn" type="button" class="btn btn-default disabled"><span class="glyphicon glyphicon-chevron-left"></button></div><div class="col-xs-8 col-sm-8 col-md-8 col-lg-8 text-center"><div class="btn-group"><button id="wlbtn" type="button" class="btn btn-primary"><span class="glyphicon icon-dicom-contrast"></span></button> <button id="pickerbtn" type="button" class="btn btn-default"><span class="glyphicon glyphicon-screenshot"></span></button> <button id="lengthbtn" type="button" class="btn btn-default"><span class="glyphicon icon-dicom-length"></span></button> <button id="anglebtn" type="button" class="btn btn-default"><span class="glyphicon icon-dicom-angle"></span></button> <button id="stackbtn" type="button" class="btn btn-default"><span class="glyphicon icon-dicom-stack"></span></button> <button id="movebtn" type="button" class="btn btn-default"><span class="glyphicon icon-dicom-move"></span></button></div></div><div class="col-xs-2 col-sm-2 col-md-2 col-lg-2 text-left"><button id="nextbtn" type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button></div></div></div><div class="panel-footer text-right">Jean-Francois Pambrun - <a id="stats" href="javascript:void(0)">stats</a></div></div></div><div class="modal fade" id="statsModal" tabindex="-1" role="dialog" aria-labelledby="statsModal" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span> <span class="sr-only">Close</span></button><h4 class="modal-title" id="myModalLabel">Download/Decode stats</h4></div><div class="modal-body" id="innerStats"></div></div></div></div></body></html>